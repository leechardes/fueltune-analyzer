# Tox configuration for FuelTune testing
# ========================================

[tox]
envlist = py{310,311,312}, lint, coverage
skipsdist = True

[testenv]
deps = 
    -r requirements.txt
    -r requirements-test.txt
commands =
    pytest tests/ -v --tb=short

[testenv:coverage]
deps = 
    {[testenv]deps}
commands =
    pytest tests/ --cov=src --cov-report=term-missing --cov-report=html --cov-report=xml

[testenv:lint]
deps =
    black
    isort
    flake8
    pylint
    mypy
commands =
    black --check src/ tests/
    isort --check-only src/ tests/
    flake8 src/ tests/
    pylint src/
    mypy src/

[testenv:format]
deps =
    black
    isort
    autoflake
commands =
    autoflake --in-place --remove-all-unused-imports --recursive src/ tests/
    isort src/ tests/
    black src/ tests/

[testenv:test-unit]
deps = {[testenv]deps}
commands =
    pytest tests/unit/ -v --tb=short

[testenv:test-integration]
deps = {[testenv]deps}
commands =
    pytest tests/integration/ -v --tb=short

[testenv:test-ui]
deps = {[testenv]deps}
commands =
    pytest tests/ui/ -v --tb=short

[testenv:benchmark]
deps = 
    {[testenv]deps}
    pytest-benchmark
commands =
    pytest tests/ --benchmark-only

[pytest]
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
addopts = 
    --strict-markers
    --tb=short
    -ra
markers =
    slow: marks tests as slow (deselect with '-m "not slow"')
    integration: marks tests as integration tests
    unit: marks tests as unit tests
    ui: marks tests as UI tests

[flake8]
max-line-length = 100
exclude = .git,__pycache__,venv,build,dist,.tox
ignore = E203,W503,E501

[isort]
profile = black
line_length = 100
multi_line_output = 3
include_trailing_comma = True

[mypy]
python_version = 3.12
warn_return_any = True
warn_unused_configs = True
disallow_untyped_defs = True
ignore_missing_imports = True